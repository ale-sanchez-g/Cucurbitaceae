--- 
reset_minion: true

# Build Environment
build_environment: Ubuntu 12.04

# Create directories for test and coverage reports
before_script:
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  
integrations: 
  hub: 
    - integrationName: AlejandroPrivate
      type: docker
  notifications:
    - integrationName: Minion
      type: slack
      recipients:
        - "#au_ops_and_env_health"
      on_success: never
      on_failure: never
build:
  ci:
    - docker ps -a
    - app="report-container"		
    - if docker ps | awk -v app="app" 'NR>1{  ($(NF) == app )  }'; then docker stop "$app" && docker rm -f "$app"; fi >> log.txt		
    - app="db-container"		
    - if docker ps | awk -v app="app" 'NR>1{  ($(NF) == app )  }'; then docker stop "$app" && docker rm -f "$app"; fi >> log.txt
    - docker run --name db-container -e MYSQL_ROOT_PASSWORD=root -d mysql/mysql-server
    - docker run --name report-container -d --link db-container:db -p 8080:80 morsisdivine/cucumber-historical-reports:latest
    - cat log.txt
    - docker ps -a
    - curl localhost
